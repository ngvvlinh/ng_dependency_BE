syntax = "proto2";
package affiliate;
option go_package = "etop.vn/backend/pb/services/affiliate";
import "protoc-gen-swagger/options/annotations.proto";
option (grpc.gateway.protoc_gen_swagger.options.openapiv2_swagger) = {
    info: {
        title: "eTop API: Affiliate service";
version:"v1";
};
};

import "gogoproto/gogo.proto";
option (gogoproto.equal_all) = false;
option (gogoproto.gogoproto_import) = false;
option (gogoproto.goproto_enum_prefix_all) = true;
option (gogoproto.goproto_getters_all) = true;
option (gogoproto.goproto_unrecognized_all) = false;
option (gogoproto.gostring_all) = false;
option (gogoproto.marshaler_all) = false;
option (gogoproto.onlyone_all) = false;
option (gogoproto.sizer_all) = false;
option (gogoproto.testgen_all) = false;
option (gogoproto.unmarshaler_all) = false;
option (gogoproto.verbose_equal_all) = false;
import "common/common.proto";
import "google/protobuf/timestamp.proto";
import "etop/shop/shop.proto";
//service MiscService {
//    rpc VersionInfo(cm.Empty) returns (cm.VersionInfoResponse);
//}

service UserService {
    rpc UpdateReferral(UpdateReferralRequest) returns (UserReferral);
}

service TradingService {
    rpc TradingGetProducts (cm.CommonListRequest) returns (SupplyGetProductsResponse);
    rpc CreateOrUpdateTradingCommissionSetting (CreateOrUpdateTradingCommissionSettingRequest) returns (SupplyCommissionSetting);
    rpc GetTradingProductPromotionByProductIDs (GetTradingProductPromotionByIDsRequest) returns (GetTradingProductPromotionByIDsResponse);
    rpc GetTradingProductPromotions (cm.CommonListRequest) returns (GetProductPromotionsResponse);
    rpc CreateTradingProductPromotion (CreateOrUpdateProductPromotionRequest) returns (ProductPromotion);
    rpc UpdateTradingProductPromotion (CreateOrUpdateProductPromotionRequest) returns (ProductPromotion);
}

service ShopService {
    rpc GetProductPromotion (GetProductPromotionRequest) returns (GetProductPromotionResponse);
    rpc ShopGetProducts (cm.CommonListRequest) returns (ShopGetProductsResponse);
    rpc CheckReferralCodeValid(CheckReferralCodeValidRequest) returns (GetProductPromotionResponse);
}

service AffiliateService {
    rpc GetCommissions (cm.CommonListRequest) returns (GetCommissionsResponse);
    rpc NotifyNewShopPurchase (NotifyNewShopPurchaseRequest) returns (NotifyNewShopPurchaseResponse);
    rpc GetTransactions (cm.CommonListRequest) returns (GetTransactionsResponse);
    rpc CreateOrUpdateAffiliateCommissionSetting (CreateOrUpdateCommissionSettingRequest) returns (CommissionSetting);
    rpc GetProductPromotionByProductID (GetProductPromotionByProductIDRequest) returns (GetProductPromotionByProductIDResponse);
    rpc AffiliateGetProducts (cm.CommonListRequest) returns (AffiliateGetProductsResponse);
    rpc CreateReferralCode (CreateReferralCodeRequest) returns (ReferralCode);
    rpc GetReferralCodes (cm.CommonListRequest) returns (GetReferralCodesResponse);
    rpc GetReferrals (cm.CommonListRequest) returns (GetReferralsResponse);
}

message UpdateReferralRequest {
    optional string referral_code = 2 [(gogoproto.nullable) = false];
    optional string sale_referral_code = 3 [(gogoproto.nullable) = false];
}

message UserReferral {
    optional int64 user_id = 1 [(gogoproto.nullable) = false];
    optional string referral_code = 2  [(gogoproto.nullable) = false];
    optional string sale_referral_code = 3  [(gogoproto.nullable) = false];
}

message GetCommissionsResponse {
    optional string message = 1 [(gogoproto.nullable) = false];
}
message NotifyNewShopPurchaseRequest {
    optional int64 order_id = 1 [(gogoproto.nullable) = false];
}
message NotifyNewShopPurchaseResponse {
    optional string message = 1 [(gogoproto.nullable) = false];
}
message GetCouponsResponse {
    repeated Coupon coupons = 1;
}
message CreateCouponRequest {
    optional int32 value = 1 [(gogoproto.nullable) = false];
    optional string unit = 2 [(gogoproto.nullable) = true];
    optional string description = 3 [(gogoproto.nullable) = true];
    optional int64 product_id = 4 [(gogoproto.nullable) = false];
}
message Coupon {
    optional int64 id = 1 [(gogoproto.nullable) = false];
    optional string code = 2 [(gogoproto.nullable) = false];
    optional int32 value = 3 [(gogoproto.nullable) = false];
    optional string unit = 4 [(gogoproto.nullable) = false];
    optional string description = 5 [(gogoproto.nullable) = true];
    optional int64 user_id = 6 [(gogoproto.nullable) = false];
    optional google.protobuf.Timestamp start_date = 7;
    optional google.protobuf.Timestamp end_date = 8;
    optional int64 product_id = 9 [(gogoproto.nullable) = false];
    optional google.protobuf.Timestamp created_at = 10;
    optional google.protobuf.Timestamp updated_at = 11;
}
message GetTransactionsResponse {
    repeated Transaction transactions = 1;
}
message Transaction {
}

message CommissionSetting {
    optional int64 product_id = 2 [(gogoproto.nullable) = false];
    optional int32 amount = 3 [(gogoproto.nullable) = false];
    optional string unit = 4 [(gogoproto.nullable) = false];
    optional google.protobuf.Timestamp created_at = 5;
    optional google.protobuf.Timestamp updated_at = 6;
}

message SupplyCommissionSetting {
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional int32 level1_direct_commission = 2  [(gogoproto.nullable) = false];
    optional int32 level1_indirect_commission = 3  [(gogoproto.nullable) = false];
    optional int32 level2_direct_commission = 4  [(gogoproto.nullable) = false];
    optional int32 level2_indirect_commission = 5  [(gogoproto.nullable) = false];
    optional string depend_on = 6  [(gogoproto.nullable) = false];
    optional int32 level1_limit_count = 7  [(gogoproto.nullable) = false];
    optional SupplyCommissionSettingDurationObject m_lifetime_duration = 8 [(gogoproto.nullable) = true];
    optional SupplyCommissionSettingDurationObject m_level1_limit_duration = 11 [(gogoproto.nullable) = true];
    optional google.protobuf.Timestamp created_at = 9  [(gogoproto.nullable) = true];
    optional google.protobuf.Timestamp updated_at = 10  [(gogoproto.nullable) = true];
}

message SupplyCommissionSettingDurationObject {
    optional int32 duration = 1 [(gogoproto.nullable) = false];
    optional string type = 2 [(gogoproto.nullable) = false];
}

message GetEtopCommissionSettingByProductIDsRequest {
    repeated int64 product_ids = 1;
}

message GetEtopCommissionSettingByProductIDsResponse {
    repeated CommissionSetting etop_commission_settings = 1;
}

message GetCommissionSettingByProductIDsRequest {
    repeated int64 product_ids = 1;
}

message GetCommissionSettingByProductIDsResponse {
    repeated CommissionSetting commission_settings = 1;
}

message CreateOrUpdateCommissionSettingRequest {
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional int32 amount = 2 [(gogoproto.nullable) = false];
    optional string unit = 3 [(gogoproto.nullable) = true];
}

message CreateOrUpdateTradingCommissionSettingRequest {
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional int32 level1_direct_commission = 2 [(gogoproto.nullable) = false];
    optional int32 level1_indirect_commission = 3 [(gogoproto.nullable) = false];
    optional int32 level2_direct_commission = 4  [(gogoproto.nullable) = false];
    optional int32 level2_indirect_commission = 5  [(gogoproto.nullable) = false];

    // product, customer
    optional string depend_on = 6  [(gogoproto.nullable) = false];
    optional int32 level1_limit_count = 7  [(gogoproto.nullable) = false];

    // day, month
    optional string level1_limit_duration_type = 9 [(gogoproto.nullable) = false];
    optional int32 level1_limit_duration = 10 [(gogoproto.nullable) = false];

    // day, month
    optional string lifetime_duration_type = 11  [(gogoproto.nullable) = false];
    optional int32 lifetime_duration = 12  [(gogoproto.nullable) = false];
}

message ProductPromotion {
    optional shop.ShopProduct product = 1;
    optional int64 id = 2 [(gogoproto.nullable) = false];
    optional int64 product_id = 3 [(gogoproto.nullable) = false];
    optional int32 amount = 4 [(gogoproto.nullable) = false];
    optional string unit = 5 [(gogoproto.nullable) = false];
    optional string type = 6 [(gogoproto.nullable) = false];
}

message CreateOrUpdateProductPromotionRequest {
    optional int64 id = 8 [(gogoproto.nullable) = false];
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional int32 amount = 2 [(gogoproto.nullable) = false];
    optional string unit = 3 [(gogoproto.nullable) = false];
    optional string code = 4 [(gogoproto.nullable) = false];
    optional string description = 5 [(gogoproto.nullable) = false];
    optional string note = 6 [(gogoproto.nullable) = false];
    optional string type = 7 [(gogoproto.nullable) = false];
}

message GetProductPromotionByProductIDRequest {

}

message GetProductPromotionByProductIDResponse {

}

message SupplyProductResponse {
    optional shop.ShopProduct product = 1;
    optional SupplyCommissionSetting supply_commission_setting = 2;
    optional ProductPromotion promotion = 3;
}

message ShopProductResponse {
    optional shop.ShopProduct product = 1;
    optional ProductPromotion promotion = 3;
}

message AffiliateProductResponse {
    optional shop.ShopProduct product = 1;
    optional CommissionSetting shop_commission_setting = 2;
    optional CommissionSetting affiliate_commission_setting = 3;
    optional ProductPromotion promotion = 4;
}

message SupplyGetProductsResponse {
    optional cm.PageInfo paging = 1;
    repeated SupplyProductResponse products = 2;
}

message ShopGetProductsResponse {
    optional cm.PageInfo paging = 1;
    repeated ShopProductResponse products = 2;
}

message CheckReferralCodeValidRequest {
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional string referral_code = 2 [(gogoproto.nullable) = false];
}

message AffiliateGetProductsResponse {
    optional cm.PageInfo paging = 1;
    repeated AffiliateProductResponse products = 2;
}

message GetProductPromotionRequest {
    optional int64 product_id = 1 [(gogoproto.nullable) = false];
    optional string referral_code = 2 [(gogoproto.nullable) = true];
}

message GetProductPromotionResponse {
    optional ProductPromotion promotion = 1;
    optional CommissionSetting referral_discount = 2;
}

message GetProductPromotionsResponse {
    optional cm.PageInfo paging = 1;
    repeated ProductPromotion promotions = 2;
}

message GetTradingProductPromotionByIDsRequest {
    repeated int64 product_ids = 1 [(gogoproto.nullable) = false];
}

message GetTradingProductPromotionByIDsResponse {
    repeated ProductPromotion promotions = 1;
}

message CreateReferralCodeRequest {
    optional string code = 1 [(gogoproto.nullable) = false];
}

message ReferralCode {
    optional string code = 1 [(gogoproto.nullable) = false];
}

message GetReferralCodesResponse {
    repeated ReferralCode referral_codes = 1;
}

message Referral {
    optional string name = 1 [(gogoproto.nullable) = false];
    optional string phone = 2 [(gogoproto.nullable) = false];
    optional string email = 3 [(gogoproto.nullable) = false];
    optional int32 order_count = 4 [(gogoproto.nullable) = false];
    optional int32 total_revenue = 5 [(gogoproto.nullable) = false];
    optional int32 total_commission = 6 [(gogoproto.nullable) = false];
    optional google.protobuf.Timestamp created_at = 7 [(gogoproto.nullable) = true];

}

message GetReferralsResponse {
    repeated Referral referrals = 1;
}