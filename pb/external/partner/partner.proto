syntax = "proto2";
package partner;
option go_package = "etop.vn/backend/pb/external/partner";

import "protoc-gen-swagger/options/annotations.proto";
option (grpc.gateway.protoc_gen_swagger.options.openapiv2_swagger) = {
    info: {
        title: "eTop External API: Partner";
        version: "v1";
    };
};

import "gogoproto/gogo.proto";
option (gogoproto.equal_all)                = false;
option (gogoproto.gogoproto_import)         = false;
option (gogoproto.goproto_enum_prefix_all)  = true;
option (gogoproto.goproto_getters_all)      = true;
option (gogoproto.goproto_unrecognized_all) = false;
option (gogoproto.gostring_all)             = false;
option (gogoproto.marshaler_all)            = false;
option (gogoproto.onlyone_all)              = false;
option (gogoproto.sizer_all)                = false;
option (gogoproto.testgen_all)              = false;
option (gogoproto.unmarshaler_all)          = false;
option (gogoproto.verbose_equal_all)        = false;

import "common/common.proto";
import "etop/etc/address_type/type.proto";
import "etop/etc/shipping/state.proto";
import "etop/etc/shipping_provider/provider.proto";
import "etop/etc/status3/status.proto";
import "etop/etc/status4/status.proto";
import "etop/etc/status5/status.proto";
import "etop/etop.proto";
import "external/external.proto";
import "external/etc/auth_mode/mode.proto";
import "external/etc/change_type/type.proto";
import "google/protobuf/timestamp.proto";

service MiscService {
    rpc VersionInfo(cm.Empty) returns (cm.VersionInfoResponse);
    rpc CurrentAccount(cm.Empty) returns (external.Partner);
    rpc GetLocationList(cm.Empty) returns (external.LocationResponse);
}

service ShopService {
    rpc AuthorizeShop(AuthorizeShopRequest) returns (AuthorizeShopResponse);
    rpc CurrentShop(cm.Empty) returns (etop.PublicAccountInfo);
}

service WebhookService {
    rpc CreateWebhook(external.CreateWebhookRequest) returns (external.Webhook);
    rpc GetWebhooks(cm.Empty) returns (external.WebhooksResponse);
    rpc DeleteWebhook(external.DeleteWebhookRequest) returns (external.WebhooksResponse);
}

service HistoryService {
    rpc GetChanges (external.GetChangesRequest) returns (external.Callback);
}

service ShippingService {
    rpc GetShippingServices(external.GetShippingServicesRequest) returns (external.GetShippingServicesResponse);
    rpc CreateAndConfirmOrder(external.CreateOrderRequest) returns (external.OrderAndFulfillments);
    rpc CancelOrder(external.CancelOrderRequest) returns (external.OrderAndFulfillments);
    rpc GetOrder(external.OrderIDRequest) returns (external.OrderAndFulfillments);
    rpc GetFulfillment(external.FulfillmentIDRequest) returns (external.Fulfillment);
}

message AuthorizeShopRequest {
    optional int64 shop_id = 2 [(gogoproto.nullable)=false];

    optional string external_shop_id = 3 [(gogoproto.nullable)=false];

    optional string name = 4 [(gogoproto.nullable)=false];

    optional string phone = 5 [(gogoproto.nullable)=false];

    optional string email = 6 [(gogoproto.nullable)=false];

    optional string redirect_url = 8 [(gogoproto.nullable)=false];
}

message AuthorizeShopResponse {
    optional string code = 1 [(gogoproto.nullable)=false];

    optional string msg = 2 [(gogoproto.nullable)=false];

    optional string type = 3 [(gogoproto.nullable)=false];

    optional string auth_token = 4 [(gogoproto.nullable)=false];

    optional int32 expires_in = 5 [(gogoproto.nullable)=false];

    optional string auth_url = 6 [(gogoproto.nullable)=false];
}
