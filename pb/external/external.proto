syntax = "proto2";
package external;
option go_package = "etop.vn/backend/pb/external";

import "protoc-gen-swagger/options/annotations.proto";
option (grpc.gateway.protoc_gen_swagger.options.openapiv2_swagger) = {
    info: {
        title: "eTop External API: Common";
        version:"v1";
    };
};

import "gogoproto/gogo.proto";
option (gogoproto.equal_all)                = false;
option (gogoproto.gogoproto_import)         = false;
option (gogoproto.goproto_enum_prefix_all)  = true;
option (gogoproto.goproto_getters_all)      = true;
option (gogoproto.goproto_unrecognized_all) = false;
option (gogoproto.gostring_all)             = false;
option (gogoproto.marshaler_all)            = false;
option (gogoproto.onlyone_all)              = false;
option (gogoproto.sizer_all)                = false;
option (gogoproto.testgen_all)              = false;
option (gogoproto.unmarshaler_all)          = false;
option (gogoproto.verbose_equal_all)        = false;

import "common/common.proto";
import "etop/etc/gender/gender.proto";
import "etop/etc/shipping/state.proto";
import "etop/etc/shipping_provider/provider.proto";
import "etop/etc/status3/status.proto";
import "etop/etc/status4/status.proto";
import "etop/etc/status5/status.proto";
import "etop/etc/try_on/code.proto";
import "etop/etop.proto";
import "etop/order/order.proto";
import "google/protobuf/timestamp.proto";

message Partner {
    optional int64 id = 1 [(gogoproto.nullable)=false];
    optional string name = 2 [(gogoproto.nullable)=false];
    optional string public_name = 24 [(gogoproto.nullable)=false];
    optional etop.AccountType type = 3 [(gogoproto.nullable)=false];
    optional string phone = 9 [(gogoproto.nullable)=false];

    // only domain, no scheme
    optional string website = 5 [(gogoproto.nullable)=false];
    optional string website_url = 14 [(gogoproto.nullable)=false];
    optional string image_url = 15 [(gogoproto.nullable)=false];
    optional string email = 16 [(gogoproto.nullable)=false];
    repeated string recognized_hosts = 17;
    repeated string redirect_urls = 18;
}

message CreateWebhookRequest {
    repeated string entities = 2;
    repeated string fields = 3;
    optional string url = 4 [(gogoproto.nullable)=false];
    optional string metadata = 5 [(gogoproto.nullable)=false];
}

message DeleteWebhookRequest {
    optional int64 id = 1 [(gogoproto.nullable)=false];
}

message WebhooksResponse {
    repeated Webhook webhooks = 1;
}

message Webhook {
    optional int64 id = 1 [(gogoproto.nullable)=false];
    repeated string entities = 2;
    repeated string fields = 3;
    optional string url = 4 [(gogoproto.nullable)=false];
    optional string metadata = 5 [(gogoproto.nullable)=false];
    optional google.protobuf.Timestamp created_at = 6;

    optional WebhookStates states = 7;
}

message WebhookStates {
    optional string state  = 1 [(gogoproto.nullable)=false];
    optional google.protobuf.Timestamp last_sent_at = 2;
    optional WebhookError last_error = 3;
}

message WebhookError {
    optional string error  = 1 [(gogoproto.nullable)=false];
    optional int32  resp_status = 2 [(gogoproto.nullable)=false];
    optional string resp_body = 3 [(gogoproto.nullable)=false];
    optional int32  retried = 4 [(gogoproto.nullable)=false];
    optional google.protobuf.Timestamp sent_at = 5;
}

message GetChangesRequest {
    optional cm.ForwardPaging paging = 1;
    optional string entity = 2;
    optional string entity_id = 3;
}

message Callback {
    optional int64 id = 1 [(gogoproto.nullable)=false];
    repeated Change changes = 2;
}

// ChangesData serialize changes data for storing in MongoDB
message ChangesData {
    // for using with mongodb
    optional int64 _id = 1 [(gogoproto.nullable)=false];
    optional int64 webhook_id = 3 [(gogoproto.nullable)=false];
    optional int64 account_id = 4 [(gogoproto.nullable)=false];
    optional google.protobuf.Timestamp created_at = 5;
    repeated Change changes = 6;
}

message Change {
    optional google.protobuf.Timestamp time = 2;
    optional string change_type = 3 [(gogoproto.nullable)=false];
    optional string entity = 4 [(gogoproto.nullable)=false];
    optional LatestOneOf latest = 5;
    optional ChangeOneOf changed = 6;
}

message LatestOneOf {
    optional Order order = 7;
    optional Fulfillment fulfillment = 8;
}

message ChangeOneOf {
    optional Order order = 5;
    optional Fulfillment fulfillment = 6;
}

message CancelOrderRequest {
    optional int64 id = 1 [(gogoproto.nullable)=false];

    optional string code = 2 [(gogoproto.nullable)=false];

    optional string external_id = 3 [(gogoproto.nullable)=false];

    optional string cancel_reason = 4 [(gogoproto.nullable)=false];
}

message OrderIDRequest {
    optional int64 id = 1 [(gogoproto.nullable)=false];

    optional string code = 2 [(gogoproto.nullable)=false];

    optional string external_id = 3 [(gogoproto.nullable)=false];
}

message FulfillmentIDRequest {
    optional int64 id = 1 [(gogoproto.nullable)=false];

    optional string shipping_code = 2 [(gogoproto.nullable)=false];
}

message OrderAndFulfillments {
    optional Order order = 1;
    repeated Fulfillment fulfillments = 2;
    repeated cm.Error fulfillment_errors = 3;
}

message Order {
    optional int64 id = 1 [(gogoproto.nullable)=false];

    optional int64 shop_id = 2 [(gogoproto.nullable)=false];

    optional string code = 3;

    optional string external_id = 4;

    optional string external_code = 5;

    optional string external_url = 6;

    optional string self_url = 7;

//    optional OrderCustomer  customer          =  9;

    optional OrderAddress customer_address    = 10;

    optional OrderAddress shipping_address    = 12;

    optional google.protobuf.Timestamp created_at   = 13;

    optional google.protobuf.Timestamp processed_at = 14;

    optional google.protobuf.Timestamp updated_at   = 15;

    optional google.protobuf.Timestamp closed_at    = 16;

    optional google.protobuf.Timestamp confirmed_at = 17;

    optional google.protobuf.Timestamp cancelled_at = 18;

    optional string cancel_reason = 19;

    optional status3.Status confirm_status = 70;

    optional status5.Status status = 34;

    optional status5.Status fulfillment_shipping_status = 36;

    optional status4.Status etop_payment_status = 69;

    repeated OrderLine lines = 41;

    optional int32 total_items  = 43;

    optional int32 basket_value = 44;

//    optional int32 total_weight = 45;

    optional int32 order_discount = 46;

    optional int32 total_discount = 47;

//    optional int32 shipping_fee = 48;

    optional int32 total_fee = 49;

    repeated order.OrderFeeLine fee_lines = 50;

    optional int32 total_amount = 51;

    optional string order_note = 59;

    optional OrderShipping shipping = 60;

//    optional string shipping_note = 51;

//    optional OrderAddress pick_address = 53;

//    optional shipping_provider.ShippingProvider shipping_provider = 54;

//    optional string shipping_service_code = 55;

//    optional try_on.TryOnCode try_on = 56;
}

message OrderShipping {
    optional OrderAddress pickup_address = 1;

    optional OrderAddress return_address = 17;

    optional string shipping_service_name = 16;

    optional string shipping_service_code = 2;

    optional int32 shipping_service_fee = 3;

    optional shipping_provider.ShippingProvider carrier = 5;

    optional bool include_insurance = 6;

    optional try_on.TryOnCode try_on = 7;

    optional string shipping_note = 8;

    optional int32 cod_amount = 9;

    optional int32 gross_weight = 10;

    optional int32 length = 11;

    optional int32 width = 12;

    optional int32 height = 13;

    optional int32 chargeable_weight = 15;
}

message CreateOrderRequest {

    optional string external_id = 4 [(gogoproto.nullable)=false];

    optional string external_code = 5 [(gogoproto.nullable)=false];

    optional string external_url = 6 [(gogoproto.nullable)=false];

    optional OrderAddress customer_address    = 10;

    optional OrderAddress shipping_address    = 12;

    repeated OrderLine lines = 41;

    optional int32 total_items  = 43 [(gogoproto.nullable)=false];

    // basket_value = SUM(lines.retail_price)
    optional int32 basket_value = 44 [(gogoproto.nullable)=false];

    optional int32 order_discount = 46 [(gogoproto.nullable)=false];

    optional int32 total_discount = 47 [(gogoproto.nullable)=false];

    optional int32 total_fee = 49;

    repeated order.OrderFeeLine fee_lines = 48;

    optional int32 total_amount = 50 [(gogoproto.nullable)=false];

    optional string order_note = 51 [(gogoproto.nullable)=false];

    optional OrderShipping shipping = 60;

    map<string,string> external_meta = 62;
}

message OrderLine {
    optional int64 variant_id = 3 [(gogoproto.nullable)=false];
    optional int64 product_id = 23 [(gogoproto.nullable)=false];
    optional string product_name = 7 [(gogoproto.nullable)=false];

//    optional bool is_outside_etop = 8 [(gogoproto.nullable)=false];

    optional int32 quantity = 17 [(gogoproto.nullable)=false];

    optional int32 list_price    = 18 [(gogoproto.nullable)=false];

    optional int32 retail_price  = 19 [(gogoproto.nullable)=false];

    // payment_price = retail_price - discount_per_item
    optional int32 payment_price = 20;

    optional string image_url = 21 [(gogoproto.nullable)=false];

    repeated order.Attribute attributes = 22;

    // total_discount = (payment_price - retail_price) * quantity
//    optional int32 total_discount = 24 [(gogoproto.nullable)=false];
}

message Fulfillment {
    optional int64 id          = 1 [(gogoproto.nullable)=false];

    optional int64 order_id    = 2 [(gogoproto.nullable)=false];

    optional int64 shop_id     = 3 [(gogoproto.nullable)=false];

    optional string self_url = 4;

    optional int32 total_items      =  6;

//    optional int32 total_weight     =  7;

    optional int32 basket_value     = 10;

    // total_cod_amount may be different from order.shop_cod when the
    // fulfillment is partially delivered (e.g. the fulfillment has 2 items but
    // the customer takes one, returns one)
//    optional int32 total_cod_amount =  9;

    optional google.protobuf.Timestamp created_at   = 11;

    optional google.protobuf.Timestamp updated_at   = 13;

    optional google.protobuf.Timestamp closed_at    = 14;

    optional google.protobuf.Timestamp cancelled_at = 16;

    optional string cancel_reason = 17;

    optional shipping_provider.ShippingProvider carrier = 18;

    optional string shipping_service_name     = 27;

    optional int32 shipping_service_fee     = 28;

    optional int32 actual_shipping_service_fee = 33;

    optional string shipping_service_code     = 29;

    optional string shipping_code     = 22;

    optional string shipping_note     = 19;

    optional try_on.TryOnCode try_on  = 20;

    optional bool include_insurance  = 21;

//    optional google.protobuf.Timestamp cod_etop_transfered_at  = 43;

    optional status3.Status confirm_status = 24;

    optional shipping.State shipping_state = 25;

    optional status5.Status shipping_status = 50;

    optional status5.Status status         = 26;

    optional int32 cod_amount = 9;

    optional int32 actual_cod_amount = 40;

    optional int32 chargeable_weight = 23;

//    optional int32 shipping_fee_customer = 27;

//    optional int32 shipping_fee_shop     = 28;

    optional OrderAddress pickup_address  = 30;

    optional OrderAddress return_address  = 31;

    optional OrderAddress shipping_address  = 32;

    optional status4.Status etop_payment_status = 69;

    optional google.protobuf.Timestamp estimated_delivery_at = 74;

    optional google.protobuf.Timestamp estimated_pickup_at  = 75;
}

message Ward {
    optional string name = 1 [(gogoproto.nullable)=false];
}

message District {
    optional string name = 1 [(gogoproto.nullable)=false];
    repeated Ward wards = 2 [(gogoproto.nullable)=false];
}

message Province {
    optional string name = 1 [(gogoproto.nullable)=false];
    repeated District districts = 2 [(gogoproto.nullable)=false];
}

message LocationResponse {
    repeated Province provinces = 1 [(gogoproto.nullable)=false];
}

message GetShippingServicesRequest {

    optional LocationAddress pickup_address = 1;

    optional LocationAddress shipping_address = 2;

    // in gram (g)
    optional int32  gross_weight = 12 [(gogoproto.nullable)=false];// in gram (g)

    // in gram (g)
    optional int32  chargeable_weight = 5 [(gogoproto.nullable)=false];

    // in centimetre (cm)
    optional int32  length = 6 [(gogoproto.nullable)=false];

    // in centimetre (cm)
    optional int32  width  = 7 [(gogoproto.nullable)=false];

    // in centimetre (cm)
    optional int32  height = 8 [(gogoproto.nullable)=false];

    optional int32  basket_value = 10 [(gogoproto.nullable)=false];

    optional int32  cod_amount = 11 [(gogoproto.nullable)=false];

    optional bool include_insurance = 13;
}

message LocationAddress {
    optional string province = 1 [(gogoproto.nullable)=false];
    optional string district = 2 [(gogoproto.nullable)=false];
}

message GetShippingServicesResponse {
    repeated ShippingService services = 1;
}

message ShippingService {
    optional string code = 1 [(gogoproto.nullable)  = false];

    optional string name = 2 [(gogoproto.nullable)  = false];

    optional int32  fee = 3 [(gogoproto.nullable)  = false];

    optional shipping_provider.ShippingProvider carrier = 4 [(gogoproto.nullable)=false];

    optional google.protobuf.Timestamp estimated_pickup_at = 5;

    optional google.protobuf.Timestamp estimated_delivery_at = 6;
}

message OrderCustomer {
    optional string full_name = 1 [(gogoproto.nullable)=false];
    optional string email = 2 [(gogoproto.nullable)=false];
    optional string phone = 3 [(gogoproto.nullable)=false];
    optional gender.Gender gender = 5 [(gogoproto.nullable)=false];
}

message OrderAddress {
    optional string full_name   = 1 [(gogoproto.nullable)=false];
    optional string phone       = 3 [(gogoproto.nullable)=false];
    optional string email       = 4 [(gogoproto.nullable)=false];
    optional string province    = 7 [(gogoproto.nullable)=false];
    optional string district    = 8 [(gogoproto.nullable)=false];
    optional string ward        = 9 [(gogoproto.nullable)=false];
    optional string company     = 11 [(gogoproto.nullable)=false];
    optional string address1    = 12 [(gogoproto.nullable)=false];
    optional string address2    = 13 [(gogoproto.nullable)=false];
}
